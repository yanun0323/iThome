# Day 24: Memento Pattern - æ™‚å…‰å€‰åº«ç®¡ç†å“¡

## è€é—†èªéŒ„ ğŸ’¬

> "æŠŠæ¯å€‹ç‰ˆæœ¬éƒ½ä¿å­˜èµ·ä¾†ï¼ä¸Šåˆçš„ç‰ˆæœ¬ã€ä¸‹åˆçš„ç‰ˆæœ¬ã€æˆ‘å¿ƒæƒ…å¥½æ™‚çš„ç‰ˆæœ¬ã€æˆ‘å¿ƒæƒ…ä¸å¥½æ™‚çš„ç‰ˆæœ¬ï¼Œèªªä¸å®šå“ªå¤©æˆ‘åˆæƒ³è¦èˆŠç‰ˆæœ¬äº†ï¼"

## ç½é›£ç¾å ´ ğŸ”¥

é€±ä¸‰ä¸Šåˆ 10 é»ï¼Œä½ æ­£åœ¨å°ˆå¿ƒå¯«ç¨‹å¼ï¼Œè€é—†çªç„¶è¡åˆ°ä½ æ¡Œå‰ï¼Œè‡‰è‰²æ…Œå¼µã€‚

ã€Œå¿«ï¼å¿«æŠŠç³»çµ±æ”¹å›æ˜¨å¤©çš„ç‰ˆæœ¬ï¼ã€è€é—†æ€¥å¾—è·ºè…³ã€‚

ä½ å›°æƒ‘åœ°å•ï¼šã€Œç‚ºä»€éº¼ï¼Ÿæ–°ç‰ˆæœ¬ä¸æ˜¯å·²ç¶“ä¸Šç·šäº†å—ï¼Ÿã€

ã€Œå®¢æˆ¶èªªä¸å–œæ­¡æ–°ä»‹é¢ï¼ã€è€é—†æŠ“è‘—é ­é«®ï¼Œã€Œä»–å€‘è¦èˆŠç‰ˆæœ¬çš„æ„Ÿè¦ºï¼Œä½†è¦ä¿ç•™æ–°åŠŸèƒ½ï¼ã€

ä½ ç¿»äº†ç¿» Git è¨˜éŒ„ï¼šã€Œå¯æ˜¯...æˆ‘å€‘å·²ç¶“æŠŠå¾ˆå¤šæ±è¥¿åˆä½µäº†...ã€

ã€Œä»€éº¼å«åˆä½µï¼Ÿã€è€é—†æ›´æ…Œäº†ï¼Œã€Œä½ ä¸æ˜¯èªªæœƒä¿å­˜æ¯å€‹ç‰ˆæœ¬å—ï¼Ÿã€

é€™æ™‚å€™ï¼Œç”¢å“ç¶“ç†å°ç¾ä¹Ÿæ¹Šéä¾†ï¼šã€Œæˆ‘å€‘é‚„éœ€è¦ä¸Šå€‹æœˆçš„å ±è¡¨æ ¼å¼ï¼Œä½†è¦ç”¨é€™å€‹æœˆçš„æ•¸æ“š...ã€

è¨­è¨ˆå¸«é˜¿å‡±ä¹ŸåŠ å…¥ï¼šã€Œè€é—†æ˜¨å¤©èªªè¦ç”¨ç¬¬ä¸‰ç‰ˆçš„è¨­è¨ˆï¼Œä»Šå¤©åˆèªªè¦ç¬¬ä¸€ç‰ˆçš„é¡è‰²é…ç¬¬äºŒç‰ˆçš„å¸ƒå±€...ã€

è€é—†è½å¾—é ­æ›´å¤§äº†ï¼šã€Œç‚ºä»€éº¼ä¸èƒ½æœ‰ä¸€å€‹ã€æ™‚å…‰æ©Ÿã€ï¼Ÿæˆ‘æƒ³è¦ä»€éº¼æ™‚å€™çš„ç‰ˆæœ¬å°±èƒ½ç«‹åˆ»æ‹¿åˆ°ï¼Ÿã€

ç³»çµ±åˆ†æå¸«è€å¼µå˜†æ°£ï¼šã€Œé‚£æˆ‘å€‘è¦å»ºä¸€å€‹ã€ç‰ˆæœ¬å€‰åº«ã€å—ï¼Ÿã€

ã€Œå°ï¼ã€è€é—†çœ¼ç¥ç™¼äº®ï¼Œã€Œæˆ‘è¦ä¸€å€‹ã€æ™‚å…‰å€‰åº«ã€ï¼æ¯æ¬¡æœ‰é‡è¦æ”¹å‹•ï¼Œå°±è‡ªå‹•ä¿å­˜ä¸€å€‹å¿«ç…§ï¼æˆ‘æƒ³è¦ä»€éº¼æ™‚å€™çš„ç‹€æ…‹ï¼Œå°±èƒ½ç«‹åˆ»æ¢å¾©ï¼ã€

ä»–é–‹å§‹åœ¨ç™½æ¿ä¸Šç•«åœ–ï¼šã€Œè€Œä¸”é€™å€‹å€‰åº«è¦å¾ˆè°æ˜ï¼çŸ¥é“ä»€éº¼æ™‚å€™è©²ä¿å­˜ï¼Œä¿å­˜å“ªäº›è³‡æ–™ï¼Œé‚„è¦èƒ½å¤ å®Œç¾é‚„åŸï¼ã€

å‰ç«¯å·¥ç¨‹å¸«å°æç–‘æƒ‘åœ°å•ï¼šã€Œä½†æ˜¯æ¯å€‹ç‰ˆæœ¬çš„å…§éƒ¨çµæ§‹å¯èƒ½éƒ½ä¸ä¸€æ¨£å•Š...ã€

ã€Œé€™å°±æ˜¯é‡é»ï¼ã€è€é—†è¶Šèªªè¶Šèˆˆå¥®ï¼Œã€Œç³»çµ±ä¸èƒ½çŸ¥é“æˆ‘å€‘å­˜äº†ä»€éº¼ï¼Œä½†è¦èƒ½å®Œç¾å¾©åŸï¼å°±åƒã€è¨˜æ†¶è† å›Šã€ä¸€æ¨£ï¼æŠŠç•¶æ™‚çš„ç‹€æ…‹å®Œæ•´å°è£ï¼Œéœ€è¦çš„æ™‚å€™å†å®Œæ•´å–å‡ºï¼ã€

ä½ çªç„¶æç„¶å¤§æ‚Ÿï¼Œè€é—†åœ¨æè¿° **Memento Pattern** - **åœ¨ä¸ç ´å£å°è£çš„å‰æä¸‹ï¼Œæ•ç²ä¸€å€‹ç‰©ä»¶çš„å…§éƒ¨ç‹€æ…‹ï¼Œä¸¦åœ¨è©²ç‰©ä»¶ä¹‹å¤–ä¿å­˜é€™å€‹ç‹€æ…‹**ï¼

## æ¨¡å¼è§£æ ğŸ§ 

Memento Patternï¼ˆå‚™å¿˜éŒ„æ¨¡å¼ï¼‰æ˜¯è¡Œç‚ºå‹è¨­è¨ˆæ¨¡å¼ä¸­çš„æ™‚å…‰å®ˆè­·è€…ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**åœ¨ä¸é•åå°è£åŸå‰‡çš„å‰æä¸‹ï¼Œæ•ç²ä¸¦å¤–éƒ¨åŒ–ä¸€å€‹ç‰©ä»¶çš„å…§éƒ¨ç‹€æ…‹ï¼Œä»¥ä¾¿ä¹‹å¾Œèƒ½å°‡è©²ç‰©ä»¶æ¢å¾©åˆ°åŸå…ˆä¿å­˜çš„ç‹€æ…‹**ã€‚

åœ¨æˆ‘å€‘çš„æ™‚å…‰æ—…è¡Œç½é›£ä¸­ï¼Œè€é—†çš„ç‰ˆæœ¬ç®¡ç†éœ€æ±‚å®Œç¾åœ°å±•ç¾äº† Memento Pattern çš„æœ¬è³ªï¼š

1. **ç‹€æ…‹æ•ç²**ï¼šä¿å­˜ç‰©ä»¶åœ¨ç‰¹å®šæ™‚åˆ»çš„å®Œæ•´ç‹€æ…‹
2. **å°è£ä¿è­·**ï¼šä¸æš´éœ²ç‰©ä»¶çš„å…§éƒ¨å¯¦ä½œç´°ç¯€
3. **ç‹€æ…‹æ¢å¾©**ï¼šèƒ½å¤ å°‡ç‰©ä»¶æ¢å¾©åˆ°ä¹‹å‰çš„ç‹€æ…‹
4. **æ™‚å…‰æ—…è¡Œ**ï¼šæ”¯æ´å¤šå€‹æ™‚é–“é»çš„ç‹€æ…‹ç®¡ç†

Memento Pattern çš„æ ¸å¿ƒçµ„ä»¶ï¼š

- **Originator**ï¼šåŸç™¼å™¨ï¼Œå‰µå»ºå‚™å¿˜éŒ„ä¸¦ä½¿ç”¨å‚™å¿˜éŒ„æ¢å¾©ç‹€æ…‹
- **Memento**ï¼šå‚™å¿˜éŒ„ï¼Œå­˜å„²åŸç™¼å™¨çš„å…§éƒ¨ç‹€æ…‹
- **Caretaker**ï¼šè² è²¬äººï¼Œç®¡ç†å‚™å¿˜éŒ„ä½†ä¸æ“ä½œå…¶å…§å®¹

é©ç”¨æƒ…å¢ƒï¼š

- **æ’¤éŠ·æ“ä½œ**ï¼šæ–‡å­—ç·¨è¼¯å™¨ã€åœ–å½¢ç·¨è¼¯å™¨çš„ Undo åŠŸèƒ½
- **æª¢æŸ¥é»ç³»çµ±**ï¼šéŠæˆ²å­˜æª”ã€äº¤æ˜“å›æ»¾ã€ç³»çµ±å‚™ä»½
- **ç‹€æ…‹å¿«ç…§**ï¼šé…ç½®ç®¡ç†ã€å·¥ä½œæµç‹€æ…‹ä¿å­˜
- **æ­·å²è¨˜éŒ„**ï¼šç€è¦½å™¨æ­·å²ã€æ“ä½œè¨˜éŒ„è¿½è¹¤

## ç¨‹å¼ç¢¼ç¯„ä¾‹ ğŸ’»

è®“æˆ‘å€‘å¯¦ä½œä¸€å€‹ã€Œå°ˆæ¡ˆç‹€æ…‹æ™‚å…‰æ©Ÿã€ï¼Œå±•ç¤º Memento Pattern çš„æ ¸å¿ƒæ¦‚å¿µï¼š

```ts
// å‚™å¿˜éŒ„ï¼šå°ˆæ¡ˆç‹€æ…‹å¿«ç…§
class ProjectMemento {
  constructor(private readonly snapshot: any) {}

  getSnapshot(): any {
    return { ...this.snapshot }; // æ·±æ‹·è²ä¿è­·
  }
}

// åŸç™¼å™¨ï¼šå°ˆæ¡ˆç®¡ç†ç³»çµ±
class ProjectManager {
  private features: string[] = [];
  private version: string = "1.0.0";

  addFeature(feature: string): void {
    this.features.push(feature);
    this.updateVersion();
    console.log(`âœ… æ·»åŠ åŠŸèƒ½: ${feature} (ç‰ˆæœ¬: ${this.version})`);
  }

  removeFeature(feature: string): void {
    const index = this.features.indexOf(feature);
    if (index > -1) {
      this.features.splice(index, 1);
      this.updateVersion();
    }
  }

  private updateVersion(): void {
    const parts = this.version.split('.').map(Number);
    parts[2]++;
    this.version = parts.join('.');
  }

  // å‰µå»ºå‚™å¿˜éŒ„
  createMemento(): ProjectMemento {
    return new ProjectMemento({
      features: [...this.features],
      version: this.version
    });
  }

  // å¾å‚™å¿˜éŒ„æ¢å¾©
  restoreFromMemento(memento: ProjectMemento): void {
    const snapshot = memento.getSnapshot();
    this.features = [...snapshot.features];
    this.version = snapshot.version;
    console.log(`ğŸ”„ æ¢å¾©åˆ°ç‰ˆæœ¬: ${this.version}`);
  }

  showStatus(): void {
    console.log(`ğŸ“Š ç‰ˆæœ¬: ${this.version}, åŠŸèƒ½: ${this.features.join(', ') || 'ç„¡'}`);
  }
}

// è² è²¬äººï¼šç‰ˆæœ¬ç®¡ç†å™¨
class VersionManager {
  private mementos: Map<string, ProjectMemento> = new Map();

  saveSnapshot(name: string, project: ProjectManager): void {
    const memento = project.createMemento();
    this.mementos.set(name, memento);
    console.log(`ğŸ’¾ ä¿å­˜å¿«ç…§: ${name}`);
  }

  restoreSnapshot(name: string, project: ProjectManager): void {
    const memento = this.mementos.get(name);
    if (memento) {
      project.restoreFromMemento(memento);
    } else {
      console.log(`âŒ æ‰¾ä¸åˆ°å¿«ç…§: ${name}`);
    }
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const project = new ProjectManager();
const versionManager = new VersionManager();

// é–‹ç™¼æµç¨‹
project.addFeature("ç”¨æˆ¶ç™»å…¥");
project.addFeature("å•†å“ç€è¦½");
versionManager.saveSnapshot("åŸºç¤ç‰ˆæœ¬", project);

project.addFeature("è³¼ç‰©è»Š");
versionManager.saveSnapshot("è³¼ç‰©è»Šç‰ˆæœ¬", project);

project.showStatus();

// è€é—†æ”¹è®Šä¸»æ„
console.log("\nğŸ‘” è€é—†: æ¢å¾©åˆ°åŸºç¤ç‰ˆæœ¬ï¼");
versionManager.restoreSnapshot("åŸºç¤ç‰ˆæœ¬", project);
project.showStatus();
```

## ç”Ÿå­˜æŠ€å·§ ğŸ›¡ï¸

1. **Memento è¨­è¨ˆåŸå‰‡**ï¼š

   - **å°è£ä¿è­·**ï¼šå‚™å¿˜éŒ„å°å¤–ä¸é€éœ²åŸç™¼å™¨çš„å…§éƒ¨çµæ§‹
   - **çª„ä»‹é¢**ï¼šè² è²¬äººåªèƒ½æ“ä½œå‚™å¿˜éŒ„çš„åŸºæœ¬è³‡è¨Š
   - **å¯¬ä»‹é¢**ï¼šåŸç™¼å™¨å¯ä»¥å®Œå…¨å­˜å–å‚™å¿˜éŒ„å…§å®¹
   - **ç‹€æ…‹å®Œæ•´æ€§**ï¼šç¢ºä¿ä¿å­˜çš„ç‹€æ…‹è¶³ä»¥å®Œå…¨æ¢å¾©

2. **èˆ‡è€é—†æºé€šç­–ç•¥**ï¼š

   - **æ™‚å…‰æ—…è¡Œæ„Ÿ**ï¼šå¼·èª¿èƒ½å¤ è‡ªç”±ç©¿æ¢­æ–¼ä¸åŒç‰ˆæœ¬
   - **å®‰å…¨ä¿éšœ**ï¼šèªªæ˜ä»»ä½•æ“ä½œéƒ½èƒ½å®‰å…¨å›é€€
   - **è¨˜æ†¶é«”ç®¡ç†**ï¼šè§£é‡‹å¦‚ä½•æ§åˆ¶å„²å­˜ç©ºé–“
   - **æ“ä½œç°¡ä¾¿**ï¼šå±•ç¤ºä¸€éµä¿å­˜å’Œæ¢å¾©çš„ä¾¿åˆ©

3. **æŠ€è¡“å¯¦ä½œè¦é»**ï¼š

   - **æ·±æ‹·è²**ï¼šç¢ºä¿ç‹€æ…‹ä¿å­˜çš„ç¨ç«‹æ€§
   - **è¨˜æ†¶é«”å„ªåŒ–**ï¼šé¿å…ä¿å­˜éå¤šä¸å¿…è¦çš„ç‹€æ…‹
   - **åºåˆ—åŒ–è€ƒæ…®**ï¼šè¤‡é›œç‰©ä»¶çš„ç‹€æ…‹æŒä¹…åŒ–
   - **ç‰ˆæœ¬å…¼å®¹**ï¼šè™•ç†ä¸åŒç‰ˆæœ¬é–“çš„ç‹€æ…‹å·®ç•°

4. **æ¶æ§‹æ±ºç­–å»ºè­°**ï¼š
   - **å„²å­˜ç­–ç•¥**ï¼šå…§å­˜ vs æŒä¹…åŒ–å„²å­˜
   - **æ¸…ç†æ©Ÿåˆ¶**ï¼šè‡ªå‹•æ¸…ç†èˆŠç‰ˆæœ¬é¿å…è¨˜æ†¶é«”æ´©æ¼
   - **å·®ç•°ä¿å­˜**ï¼šè€ƒæ…®åªä¿å­˜ç‹€æ…‹å·®ç•°ä»¥ç¯€çœç©ºé–“
   - **ä¸¦è¡Œå®‰å…¨**ï¼šå¤šåŸ·è¡Œç·’ç’°å¢ƒä¸‹çš„ç‹€æ…‹ä¸€è‡´æ€§

## æ˜æ—¥é å‘Š ğŸ”®

æ˜å¤©æˆ‘å€‘å°‡æ¢è¨ **Iterator Pattern - æª¢æŸ¥ç‹‚é­”**ï¼Œå­¸ç¿’å¦‚ä½•æ‡‰å°è€é—†çš„å¼·è¿«ç—‡æª¢æŸ¥ï¼šã€Œæˆ‘è¦ä¸€å€‹ä¸€å€‹æª¢æŸ¥ï¼Œä¸èƒ½æ¼æ‰ä»»ä½•ç´°ç¯€ï¼ã€

æº–å‚™è¿æ¥é€ä¸€å·¡ç¦®çš„æŒ‘æˆ°ï¼ ğŸ”
