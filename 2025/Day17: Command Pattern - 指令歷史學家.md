# Day 17: Command Pattern - æŒ‡ä»¤æ­·å²å­¸å®¶

## è€é—†èªéŒ„ ğŸ’¬

> "æˆ‘èªªéçš„æ¯å¥è©±éƒ½è¦è¨˜éŒ„ä¸‹ä¾†ï¼è€Œä¸”æˆ‘æ”¹è®Šå¿ƒæ„çš„æ™‚å€™ï¼Œè¦èƒ½ä¸€éµæ’¤å›åˆ°ä¹‹å‰çš„ç‹€æ…‹ï¼"

## ç½é›£ç¾å ´ ğŸ”¥

é€±ä¸‰ä¸‹åˆçš„ç”¢å“ä¿®æ”¹æœƒè­°ï¼Œè€é—†ååœ¨æœƒè­°æ¡Œå‰ï¼Œé¢å‰æ“ºè‘—ä¸€ç–Šä¿®æ”¹å»ºè­°ï¼Œçœ¼ç¥å°ˆæ³¨åœ°ç›¯è‘—è¢å¹•ä¸Šçš„ç³»çµ±ä»‹é¢ã€‚

ã€ŒæŠŠé€™å€‹æŒ‰éˆ•æ”¹æˆç´…è‰²ï¼ã€è€é—†ç¬¬ä¸€å€‹æŒ‡ä»¤ã€‚

UI è¨­è¨ˆå¸«å°ç¾ç«‹åˆ»å‹•æ‰‹ä¿®æ”¹ï¼šã€Œå¥½çš„ï¼Œæ”¹æˆç´…è‰²äº†ã€‚ã€

éäº†äº”åˆ†é˜ï¼Œè€é—†çšºçœ‰ï¼šã€Œç´…è‰²å¤ªåˆºçœ¼äº†ï¼Œæ”¹æˆè—è‰²ï¼ã€

å°ç¾å˜†æ°£ï¼Œå†æ¬¡ä¿®æ”¹ï¼šã€Œæ”¹æˆè—è‰²äº†...ã€

åˆéäº†ååˆ†é˜ï¼šã€Œè—è‰²å¤ªå†·æ·¡ï¼Œæ”¹æˆç¶ è‰²ï¼ä¸å°ï¼Œç¶ è‰²åƒéŒ¯èª¤è¨Šæ¯...æ”¹æˆæ©˜è‰²ï¼ã€

å°ç¾å·²ç¶“å¿«ç˜‹äº†ï¼šã€Œè€é—†ï¼Œæ‚¨åˆ°åº•è¦ä»€éº¼é¡è‰²ï¼Ÿã€

ã€Œé€™æ¨£å¥½äº†ï¼ã€è€é—†çªç„¶ç«™èµ·ä¾†ï¼Œã€Œæˆ‘è¦ä¸€å€‹ã€æŒ‡ä»¤è¨˜éŒ„ç³»çµ±ã€ï¼æŠŠæˆ‘èªªéçš„æ¯å€‹ä¿®æ”¹æŒ‡ä»¤éƒ½è¨˜ä¸‹ä¾†ï¼ŒåŒ…æ‹¬æ™‚é–“ã€å…§å®¹ã€åŸ·è¡Œçµæœï¼ã€

å·¥ç¨‹å¸«å°å¼µå›°æƒ‘åœ°å•ï¼šã€Œç‚ºä»€éº¼è¦è¨˜éŒ„é€™äº›ï¼Ÿã€

ã€Œå› ç‚ºæˆ‘è¦èƒ½ã€æ™‚å…‰å€’æµã€ï¼ã€è€é—†çœ¼ç¥ç™¼äº®ï¼Œã€Œç•¶æˆ‘èªªã€æ’¤å›åˆ° 30 åˆ†é˜å‰çš„ç‹€æ…‹ã€æ™‚ï¼Œç³»çµ±è¦èƒ½è‡ªå‹•å›åˆ°é‚£å€‹æ™‚é–“é»çš„æ¨£å­ï¼ã€

ä»–åœ¨ç™½æ¿ä¸Šç•«äº†ä¸€æ¢æ™‚é–“è»¸ï¼šã€Œæ¯å€‹æŒ‡ä»¤éƒ½æ˜¯ä¸€å€‹æ™‚é–“ç¯€é»ï¼æˆ‘è¦èƒ½è·³åˆ°ä»»ä½•ä¸€å€‹ç¯€é»ï¼é‚„è¦èƒ½ã€é‡åšã€è¢«æ’¤éŠ·çš„æ“ä½œï¼ã€

ç”¢å“ç¶“ç†é˜¿è¯æ“”å¿ƒåœ°èªªï¼šã€Œé€™æ¨£ä¸æœƒå¾ˆè¤‡é›œå—ï¼Ÿã€

ã€Œä¸è¤‡é›œï¼ã€è€é—†è¶Šèªªè¶Šèˆˆå¥®ï¼Œã€Œå°±åƒéŒ„éŸ³æ©Ÿä¸€æ¨£ï¼æ’­æ”¾ã€æš«åœã€å¿«è½‰ã€å€’å¸¶ã€é‡æ’­ï¼æ¯å€‹æŒ‰éˆ•éƒ½æ˜¯ä¸€å€‹åŠŸèƒ½ï¼Œæ¯å€‹åŠŸèƒ½éƒ½èƒ½ç¨ç«‹åŸ·è¡Œï¼ã€

æ¸¬è©¦å·¥ç¨‹å¸«å°ææå‡ºç–‘å•ï¼šã€Œé‚£æˆ‘å€‘è¦æ€éº¼çŸ¥é“æ¯å€‹æŒ‡ä»¤çš„å…·é«”å…§å®¹ï¼Ÿã€

ã€Œå°è£å•Šï¼ã€è€é—†ç•«äº†ä¸€å€‹å€‹å°ç›’å­ï¼Œã€Œæ¯å€‹æŒ‡ä»¤éƒ½æ˜¯ä¸€å€‹åŒ…è£¹ï¼è£¡é¢æœ‰ã€åšä»€éº¼ã€ã€ã€æ€éº¼åšã€ã€ã€æ€éº¼æ’¤éŠ·ã€ï¼éœ€è¦çš„æ™‚å€™å°±æ‰“é–‹åŒ…è£¹åŸ·è¡Œï¼ã€

ä½ æç„¶å¤§æ‚Ÿï¼Œè€é—†å…¶å¯¦æ˜¯åœ¨æè¿° **Command Pattern** - **å°‡è«‹æ±‚å°è£æˆç‰©ä»¶ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è«‹æ±‚ã€ä½‡åˆ—æˆ–è¨˜éŒ„è«‹æ±‚ä¾†åƒæ•¸åŒ–å…¶ä»–ç‰©ä»¶**ï¼

è€é—†æœ€å¾Œç¸½çµï¼šã€Œæˆ‘å€‘è¦æˆç‚ºã€æ“ä½œæ­·å²å¤§å¸«ã€ï¼æ¯å€‹å‹•ä½œéƒ½èƒ½è¿½è¹¤ï¼Œæ¯å€‹æ±ºå®šéƒ½èƒ½åæ‚”ï¼ã€

## æ¨¡å¼è§£æ ğŸ§ 

Command Patternï¼ˆå‘½ä»¤æ¨¡å¼ï¼‰æ˜¯è¡Œç‚ºå‹è¨­è¨ˆæ¨¡å¼ä¸­çš„æ™‚å…‰å¤§å¸«ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å°‡è«‹æ±‚å°è£æˆç‰©ä»¶ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è«‹æ±‚ã€ä½‡åˆ—æˆ–è¨˜éŒ„è«‹æ±‚ä¾†åƒæ•¸åŒ–å…¶ä»–ç‰©ä»¶ï¼ŒåŒæ™‚æ”¯æ´å¯æ’¤éŠ·æ“ä½œ**ã€‚

åœ¨æˆ‘å€‘çš„æŒ‡ä»¤ç½é›£ä¸­ï¼Œè€é—†çš„æ™‚å…‰å€’æµéœ€æ±‚å®Œç¾åœ°å±•ç¾äº† Command Pattern çš„æœ¬è³ªï¼š

1. **è«‹æ±‚å°è£**ï¼šæ¯å€‹æŒ‡ä»¤éƒ½æ˜¯ç¨ç«‹çš„ç‰©ä»¶
2. **æ“ä½œè¨˜éŒ„**ï¼šæ‰€æœ‰æ“ä½œéƒ½è¢«è¨˜éŒ„ä¸‹ä¾†
3. **æ’¤éŠ·é‡åš**ï¼šæ”¯æ´ Undo/Redo åŠŸèƒ½
4. **åƒæ•¸åŒ–åŸ·è¡Œ**ï¼šå¯ä»¥å»¶é²åŸ·è¡Œæˆ–æ‰¹æ¬¡åŸ·è¡Œ

Command Pattern çš„æ ¸å¿ƒçµ„ä»¶ï¼š

- **Command**ï¼šå‘½ä»¤ä»‹é¢ï¼Œå®šç¾©åŸ·è¡Œæ“ä½œçš„æ–¹æ³•
- **ConcreteCommand**ï¼šå…·é«”å‘½ä»¤ï¼Œå¯¦ä½œ Command ä»‹é¢
- **Receiver**ï¼šæ¥æ”¶è€…ï¼ŒçŸ¥é“å¦‚ä½•å¯¦æ–½èˆ‡åŸ·è¡Œè«‹æ±‚
- **Invoker**ï¼šèª¿ç”¨è€…ï¼Œè¦æ±‚è©²å‘½ä»¤åŸ·è¡Œè«‹æ±‚

é©ç”¨æƒ…å¢ƒï¼š

- **æ’¤éŠ·/é‡åšåŠŸèƒ½**ï¼šæ–‡å­—ç·¨è¼¯å™¨ã€åœ–å½¢è»Ÿé«”
- **æ“ä½œè¨˜éŒ„**ï¼šç³»çµ±æ—¥èªŒã€å¯©è¨ˆè¿½è¹¤
- **ä½‡åˆ—æ“ä½œ**ï¼šä»»å‹™ä½‡åˆ—ã€æ‰¹æ¬¡è™•ç†
- **å·¨é›†éŒ„è£½**ï¼šè¨˜éŒ„ä¸€ç³»åˆ—æ“ä½œä¾›å¾ŒçºŒé‡æ’­

## ç¨‹å¼ç¢¼ç¯„ä¾‹ ğŸ’»

è®“æˆ‘å€‘å¯¦ä½œä¸€å€‹ã€ŒUI ä¿®æ”¹æŒ‡ä»¤ç³»çµ±ã€ï¼Œå±•ç¤º Command Pattern çš„æ ¸å¿ƒæ¦‚å¿µï¼š

```ts
// å‘½ä»¤ä»‹é¢
interface Command {
  execute(): void;
  undo(): void;
}

// æ¥æ”¶è€…ï¼šæ–‡å­—ç·¨è¼¯å™¨
class TextEditor {
  private content: string = "";

  addText(text: string): void {
    this.content += text;
    console.log(`æ–°å¢æ–‡å­—: "${text}"`);
  }

  removeText(length: number): void {
    this.content = this.content.slice(0, -length);
    console.log(`ç§»é™¤ ${length} å€‹å­—å…ƒ`);
  }

  getContent(): string {
    return this.content;
  }
}

// å…·é«”å‘½ä»¤ï¼šæ–°å¢æ–‡å­—
class AddTextCommand implements Command {
  private editor: TextEditor;
  private text: string;

  constructor(editor: TextEditor, text: string) {
    this.editor = editor;
    this.text = text;
  }

  execute(): void {
    this.editor.addText(this.text);
  }

  undo(): void {
    this.editor.removeText(this.text.length);
  }
}

// èª¿ç”¨è€…ï¼šæŒ‡ä»¤ç®¡ç†å™¨
class CommandManager {
  private history: Command[] = [];
  private currentIndex: number = -1;

  executeCommand(command: Command): void {
    command.execute();
    
    // æ¸…é™¤é‡åšæ­·å²
    this.history = this.history.slice(0, this.currentIndex + 1);
    this.history.push(command);
    this.currentIndex++;
  }

  undo(): void {
    if (this.currentIndex >= 0) {
      this.history[this.currentIndex].undo();
      this.currentIndex--;
      console.log("âª æ’¤éŠ·æ“ä½œ");
    }
  }

  redo(): void {
    if (this.currentIndex < this.history.length - 1) {
      this.currentIndex++;
      this.history[this.currentIndex].execute();
      console.log("â© é‡åšæ“ä½œ");
    }
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const editor = new TextEditor();
const manager = new CommandManager();

const cmd1 = new AddTextCommand(editor, "Hello ");
const cmd2 = new AddTextCommand(editor, "World!");

manager.executeCommand(cmd1);
manager.executeCommand(cmd2);
console.log("å…§å®¹:", editor.getContent()); // "Hello World!"

manager.undo();
console.log("æ’¤éŠ·å¾Œ:", editor.getContent()); // "Hello "

manager.redo();
console.log("é‡åšå¾Œ:", editor.getContent()); // "Hello World!"
```

## ç”Ÿå­˜æŠ€å·§ ğŸ›¡ï¸

1. **Command è¨­è¨ˆåŸå‰‡**ï¼š

   - **å°è£å®Œæ•´æ€§**ï¼šå‘½ä»¤è¦åŒ…å«åŸ·è¡Œæ‰€éœ€çš„æ‰€æœ‰è³‡è¨Š
   - **æ’¤éŠ·æ”¯æ´**ï¼šæ¯å€‹å‘½ä»¤éƒ½è¦æ”¯æ´ undo æ“ä½œ
   - **ç‹€æ…‹ç„¡é—œ**ï¼šå‘½ä»¤çš„åŸ·è¡Œä¸æ‡‰ä¾è³´å¤–éƒ¨ç‹€æ…‹
   - **åŸå­æ€§**ï¼šå‘½ä»¤çš„åŸ·è¡Œæ‡‰è©²æ˜¯åŸå­æ“ä½œ

2. **èˆ‡è€é—†æºé€šç­–ç•¥**ï¼š

   - **æ­·å²è¿½è¹¤**ï¼šå±•ç¤ºå®Œæ•´çš„æ“ä½œæ­·å²è¨˜éŒ„
   - **å³æ™‚åæ‚”**ï¼šå¼·èª¿å¯ä»¥éš¨æ™‚æ’¤éŠ·ä»»ä½•æ“ä½œ
   - **æ‰¹æ¬¡æ“ä½œ**ï¼šèªªæ˜å·¨é›†å‘½ä»¤çš„æ•ˆç‡å„ªå‹¢
   - **æ™‚å…‰æ©Ÿæ•ˆæœ**ï¼šæ¼”ç¤ºè·³è½‰åˆ°ä»»æ„æ™‚é–“é»çš„åŠŸèƒ½

3. **æŠ€è¡“å¯¦ä½œè¦é»**ï¼š

   - **è¨˜æ†¶é«”ç®¡ç†**ï¼šé™åˆ¶æ­·å²è¨˜éŒ„çš„é•·åº¦é¿å…è¨˜æ†¶é«”æ´©æ¼
   - **åºåˆ—åŒ–æ”¯æ´**ï¼šæ”¯æ´å‘½ä»¤çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–
   - **éŒ¯èª¤è™•ç†**ï¼šå„ªé›…è™•ç†å‘½ä»¤åŸ·è¡Œå¤±æ•—çš„æƒ…æ³
   - **æ•ˆèƒ½å„ªåŒ–**ï¼šå°æ–¼å¤§é‡æ“ä½œè€ƒæ…®ä½¿ç”¨å¿«ç…§æ©Ÿåˆ¶

4. **æ¶æ§‹æ±ºç­–å»ºè­°**ï¼š
   - **æŒä¹…åŒ–å­˜å„²**ï¼šè€ƒæ…®å°‡æ­·å²è¨˜éŒ„æŒä¹…åŒ–åˆ°è³‡æ–™åº«
   - **ä½µç™¼æ§åˆ¶**ï¼šå¤šç”¨æˆ¶ç’°å¢ƒä¸‹çš„å‘½ä»¤è¡çªè™•ç†
   - **æ¬Šé™æ§åˆ¶**ï¼šä¸åŒç”¨æˆ¶çš„å‘½ä»¤åŸ·è¡Œæ¬Šé™
   - **ç‰ˆæœ¬æ§åˆ¶**ï¼šå‘½ä»¤æ ¼å¼çš„ç‰ˆæœ¬å…¼å®¹æ€§

## æ˜æ—¥é å‘Š ğŸ”®

æ˜å¤©æˆ‘å€‘å°‡æ¢è¨ **State Pattern - å¿ƒæƒ…æ°£è±¡å°**ï¼Œå­¸ç¿’å¦‚ä½•æ‡‰å°è€é—†çš„æƒ…ç·’åŒ–æ±ºç­–ï¼šã€Œæˆ‘å¿ƒæƒ…å¥½çš„æ™‚å€™ä»€éº¼éƒ½å¥½èªªï¼Œå¿ƒæƒ…ä¸å¥½æ™‚å…è«‡ï¼ã€

æº–å‚™è¿æ¥æƒ…ç·’ç®¡ç†çš„æŒ‘æˆ°ï¼ ğŸŒ¦ï¸

