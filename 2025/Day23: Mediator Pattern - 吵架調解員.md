# Day 23: Mediator Pattern - åµæ¶èª¿è§£å“¡

## è€é—†èªéŒ„ ğŸ’¬

> "ä½ å€‘ä¸è¦ç›´æ¥åµæ¶ï¼Œæœ‰äº‹éƒ½ä¾†æ‰¾æˆ‘èª¿è§£ï¼æ¥­å‹™è·ŸæŠ€è¡“æœ‰ç³¾ç´›ï¼Ÿæ‰¾æˆ‘ï¼å‰ç«¯è·Ÿå¾Œç«¯ä¸åˆï¼Ÿæ‰¾æˆ‘ï¼é€£èŒ¶æ°´é–“èª°å…ˆç”¨å¾®æ³¢çˆéƒ½è¦æ‰¾æˆ‘è™•ç†ï¼"

## ç½é›£ç¾å ´ ğŸ”¥

é€±äºŒä¸‹åˆ 3 é»ï¼Œè¾¦å…¬å®¤çªç„¶çˆ†ç™¼æ¿€çƒˆçˆ­åµè²ã€‚ä½ æŠ¬é ­ä¸€çœ‹ï¼Œæ¥­å‹™éƒ¨çš„å°ç‹å’ŒæŠ€è¡“éƒ¨çš„é˜¿å¼·æ­£åœ¨æ¿€çƒˆè¨è«–è‘—ä»€éº¼ã€‚

ã€Œé€™å€‹åŠŸèƒ½æ˜æ˜å¾ˆç°¡å–®ï¼Œç‚ºä»€éº¼è¦å…©å€‹ç¦®æ‹œï¼Ÿã€å°ç‹æ‹è‘—æ¡Œå­ã€‚

ã€Œç°¡å–®ï¼Ÿä½ çŸ¥é“è¦æ”¹å¤šå°‘ç³»çµ±å—ï¼Ÿã€é˜¿å¼·ä¹Ÿä¸ç”˜ç¤ºå¼±ã€‚

é€™æ™‚å€™ï¼Œå‰ç«¯å·¥ç¨‹å¸«å°ç¾ä¹ŸåŠ å…¥æˆ°å±€ï¼šã€Œå¾Œç«¯ API æ ¼å¼åˆæ”¹äº†ï¼Œæˆ‘çš„å‰ç«¯å…¨éƒ¨è¦é‡å¯«ï¼ã€

å¾Œç«¯å·¥ç¨‹å¸«è€æåé§ï¼šã€Œå‰ç«¯ä¸€ç›´è¦æ±‚å¥‡æ€ªçš„è³‡æ–™æ ¼å¼ï¼Œæˆ‘å€‘ä¹Ÿå¾ˆç„¡å¥ˆå•Šï¼ã€

è¨­è¨ˆå¸«é˜¿å‡±ä¹Ÿè·³å‡ºä¾†ï¼šã€Œä½ å€‘éƒ½ä¸æŒ‰æˆ‘çš„è¨­è¨ˆç¨¿åšï¼Œæœ€å¾Œå‡ºå•é¡Œæ€ªæˆ‘ï¼Ÿã€

æ­£ç•¶åµæ¶è²è¶Šä¾†è¶Šå¤§æ™‚ï¼Œè€é—†å¾è¾¦å…¬å®¤è¡å‡ºä¾†ï¼šã€Œåœï¼éƒ½çµ¦æˆ‘åœä¸‹ä¾†ï¼ã€

æ‰€æœ‰äººç¬é–“å®‰éœã€‚

è€é—†åš´è‚…åœ°èªªï¼šã€Œæˆ‘ä¸æ˜¯èªªéå—ï¼Ÿæœ‰ä»»ä½•éƒ¨é–€é–“çš„ç³¾ç´›ï¼Œéƒ½è¦é€éæˆ‘ä¾†èª¿è§£ï¼ä½ å€‘é€™æ¨£ç›´æ¥å°åµï¼Œåªæœƒè®“å•é¡Œæ›´è¤‡é›œï¼ã€

ä»–é–‹å§‹åœ¨ç™½æ¿ä¸Šç•«åœ–ï¼šã€Œæˆ‘è¦å»ºç«‹ä¸€å€‹ã€æºé€šä¸­å¿ƒã€ï¼æ‰€æœ‰éƒ¨é–€éƒ½ä¸è¦ç›´æ¥æºé€šï¼Œéƒ½é€éé€™å€‹ä¸­å¿ƒï¼ã€

PM å°é™³å›°æƒ‘åœ°å•ï¼šã€Œé‚£ä¸æ˜¯å¾ˆæ²’æ•ˆç‡å—ï¼Ÿã€

ã€Œä¸ï¼ã€è€é—†æŒ‡è‘—åœ–ï¼Œã€Œé€™æ¨£æ›´æœ‰æ•ˆç‡ï¼æ¥­å‹™éƒ¨æœ‰éœ€æ±‚ï¼Ÿå‘Šè¨´æºé€šä¸­å¿ƒï¼æŠ€è¡“éƒ¨æœ‰å•é¡Œï¼Ÿå‘Šè¨´æºé€šä¸­å¿ƒï¼å‰ç«¯éœ€è¦è³‡æ–™ï¼Ÿå‘Šè¨´æºé€šä¸­å¿ƒï¼å¾Œç«¯æœ‰æ›´æ–°ï¼Ÿå‘Šè¨´æºé€šä¸­å¿ƒï¼ã€

ã€Œæºé€šä¸­å¿ƒæœƒæ ¹æ“šæƒ…æ³ï¼Œæ±ºå®šè¦é€šçŸ¥èª°ã€æ€éº¼å”èª¿ã€ä»€éº¼æ™‚å€™é–‹æœƒè¨è«–ï¼ã€è€é—†è¶Šèªªè¶Šèˆˆå¥®ï¼Œã€Œé€™æ¨£å°±ä¸æœƒæœ‰äººç›´æ¥è¡çªï¼Œæ‰€æœ‰æºé€šéƒ½æœ‰è¨˜éŒ„ï¼Œå•é¡Œéƒ½èƒ½è¿½è¹¤ï¼ã€

ç³»çµ±åˆ†æå¸«å°è‰ç–‘æƒ‘åœ°å•ï¼šã€Œé‚£æºé€šä¸­å¿ƒè¦æ€éº¼é‹ä½œï¼Ÿã€

ã€Œæ™ºèƒ½åŒ–ï¼ã€è€é—†çœ¼ç¥ç™¼äº®ï¼Œã€Œç³»çµ±æœƒçŸ¥é“å“ªäº›éƒ¨é–€éœ€è¦å”èª¿ï¼Œè‡ªå‹•å®‰æ’æœƒè­°ï¼Œåˆ†é…ä»»å‹™ï¼Œè¿½è¹¤é€²åº¦ï¼å°±åƒä¼æ¥­å…§éƒ¨çš„ã€å¤–äº¤éƒ¨ã€ï¼ã€

ä½ çªç„¶é ˜æ‚Ÿåˆ°ï¼Œè€é—†åœ¨æè¿° **Mediator Pattern** - **ç”¨ä¸€å€‹ä¸­ä»‹ç‰©ä»¶ä¾†å°è£ä¸€ç³»åˆ—ç‰©ä»¶çš„äº’å‹•ï¼Œè®“ç‰©ä»¶ä¸éœ€è¦ç›´æ¥ç›¸äº’å¼•ç”¨**ï¼

## æ¨¡å¼è§£æ ğŸ§ 

Mediator Patternï¼ˆä¸­ä»‹è€…æ¨¡å¼ï¼‰æ˜¯è¡Œç‚ºå‹è¨­è¨ˆæ¨¡å¼ä¸­çš„å¤–äº¤å®˜ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å®šç¾©ä¸€å€‹å°è£ä¸€çµ„ç‰©ä»¶å¦‚ä½•äº’å‹•çš„ç‰©ä»¶ï¼Œä¸­ä»‹è€…ä½¿å„ç‰©ä»¶ä¸éœ€è¦é¡¯å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œå¾è€Œé”åˆ°é¬†æ•£è€¦åˆ**ã€‚

åœ¨æˆ‘å€‘çš„è¾¦å…¬å®¤å¤–äº¤å±æ©Ÿä¸­ï¼Œè€é—†çš„æºé€šä¸­å¿ƒéœ€æ±‚å®Œç¾åœ°å±•ç¾äº† Mediator Pattern çš„æœ¬è³ªï¼š

1. **é›†ä¸­å”èª¿**ï¼šæ‰€æœ‰æºé€šé€éä¸­ä»‹è€…é€²è¡Œ
2. **é¬†æ•£è€¦åˆ**ï¼šå„éƒ¨é–€ä¸ç›´æ¥ç›¸äº’ä¾è³´
3. **çµ±ä¸€ç®¡ç†**ï¼šæºé€šé‚è¼¯é›†ä¸­åœ¨ä¸­ä»‹è€…
4. **è¡Œç‚ºå°è£**ï¼šè¤‡é›œçš„å”èª¿é‚è¼¯è¢«å°è£

Mediator Pattern çš„æ ¸å¿ƒçµ„ä»¶ï¼š

- **Mediator**ï¼šä¸­ä»‹è€…ä»‹é¢ï¼Œå®šç¾©åŒäº‹ç‰©ä»¶é–“çš„æºé€š
- **ConcreteMediator**ï¼šå…·é«”ä¸­ä»‹è€…ï¼Œå”èª¿å„åŒäº‹ç‰©ä»¶
- **Colleague**ï¼šåŒäº‹ç‰©ä»¶ï¼Œé€éä¸­ä»‹è€…èˆ‡å…¶ä»–ç‰©ä»¶æºé€š
- **ConcreteColleague**ï¼šå…·é«”åŒäº‹ç‰©ä»¶ï¼Œå¯¦ä½œç‰¹å®šæ¥­å‹™é‚è¼¯

é©ç”¨æƒ…å¢ƒï¼š

- **è¤‡é›œäº’å‹•ç¶²è·¯**ï¼šå¤šå€‹ç‰©ä»¶é–“è¤‡é›œçš„ç›¸äº’ä¾è³´
- **ä»‹é¢è¤‡ç”¨**ï¼šä»‹é¢é‚è¼¯éœ€è¦åœ¨å¤šå€‹åœ°æ–¹é‡ç”¨
- **å·¥ä½œæµç³»çµ±**ï¼šå¤šæ­¥é©Ÿæµç¨‹çš„å”èª¿ç®¡ç†
- **äº‹ä»¶åˆ†ç™¼**ï¼šä¸­å¤®åŒ–çš„äº‹ä»¶è™•ç†æ©Ÿåˆ¶

## ç¨‹å¼ç¢¼ç¯„ä¾‹ ğŸ’»

è®“æˆ‘å€‘å¯¦ä½œä¸€å€‹ã€Œä¼æ¥­æºé€šå”èª¿ä¸­å¿ƒã€ï¼Œå±•ç¤º Mediator Pattern çš„æ ¸å¿ƒæ¦‚å¿µï¼š

```ts
// ä¸­ä»‹è€…ä»‹é¢
interface TeamMediator {
  notify(sender: TeamMember, event: string, data: string): void;
}

// åŒäº‹ç‰©ä»¶åŸºé¡
abstract class TeamMember {
  constructor(protected mediator: TeamMediator, protected name: string) {}
}

// å…·é«”åŒäº‹ï¼šæ¥­å‹™éƒ¨
class SalesTeam extends TeamMember {
  requestFeature(feature: string): void {
    console.log(`ğŸ’¼ ${this.name}: è«‹æ±‚æ–°åŠŸèƒ½ - ${feature}`);
    this.mediator.notify(this, "feature_request", feature);
  }

  receiveResponse(message: string): void {
    console.log(`ğŸ’¼ ${this.name}: ${message}`);
  }
}

// å…·é«”åŒäº‹ï¼šæŠ€è¡“éƒ¨
class TechTeam extends TeamMember {
  evaluateFeature(feature: string): void {
    const approved = Math.random() > 0.5;
    console.log(`âš¡ ${this.name}: è©•ä¼°åŠŸèƒ½ "${feature}" - ${approved ? "å¯è¡Œ" : "å›°é›£"}`);
    this.mediator.notify(this, approved ? "feature_approved" : "feature_rejected", feature);
  }

  startDevelopment(feature: string): void {
    console.log(`ğŸ”§ ${this.name}: é–‹å§‹é–‹ç™¼ "${feature}"`);
  }
}

// å…·é«”ä¸­ä»‹è€…ï¼šå°ˆæ¡ˆå”èª¿ä¸­å¿ƒ
class ProjectCoordinator implements TeamMediator {
  constructor(private sales: SalesTeam, private tech: TechTeam) {}

  notify(sender: TeamMember, event: string, data: string): void {
    console.log(`ğŸ¢ å”èª¿ä¸­å¿ƒ: è™•ç†äº‹ä»¶ "${event}"`);

    if (event === "feature_request") {
      this.tech.evaluateFeature(data);
    } else if (event === "feature_approved") {
      this.sales.receiveResponse(`åŠŸèƒ½ "${data}" å·²æ‰¹å‡†ï¼`);
      this.tech.startDevelopment(data);
    } else if (event === "feature_rejected") {
      this.sales.receiveResponse(`åŠŸèƒ½ "${data}" è¢«æ‹’çµ•...`);
    }
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const coordinator = new ProjectCoordinator(
  new SalesTeam(null as any, "æ¥­å‹™éƒ¨"),
  new TechTeam(null as any, "æŠ€è¡“éƒ¨")
);

// é‡æ–°è¨­ç½® mediator å¼•ç”¨
const sales = new SalesTeam(coordinator, "æ¥­å‹™éƒ¨");
const tech = new TechTeam(coordinator, "æŠ€è¡“éƒ¨");

// æ¨¡æ“¬æ¥­å‹™æµç¨‹
sales.requestFeature("ç”¨æˆ¶æ¨è–¦ç³»çµ±");
sales.requestFeature("å¯¦æ™‚èŠå¤©åŠŸèƒ½");
```

## ç”Ÿå­˜æŠ€å·§ ğŸ›¡ï¸

1. **Mediator è¨­è¨ˆåŸå‰‡**ï¼š

   - **é›†ä¸­æ§åˆ¶**ï¼šè¤‡é›œé‚è¼¯é›†ä¸­åœ¨ä¸­ä»‹è€…
   - **é¬†æ•£è€¦åˆ**ï¼šåŒäº‹ç‰©ä»¶é–“ä¸ç›´æ¥ä¾è³´
   - **æ˜“æ–¼æ“´å±•**ï¼šæ·»åŠ æ–°åŒäº‹ç‰©ä»¶ç›¸å°å®¹æ˜“
   - **è²¬ä»»æ˜ç¢º**ï¼šä¸­ä»‹è€…è² è²¬å”èª¿ï¼ŒåŒäº‹è² è²¬æ¥­å‹™

2. **èˆ‡è€é—†æºé€šç­–ç•¥**ï¼š

   - **ç§©åºå¼·èª¿**ï¼šå±•ç¤ºå¦‚ä½•é¿å…æ··äº‚çš„ç›´æ¥æºé€š
   - **å¯è¿½æº¯æ€§**ï¼šèªªæ˜æ‰€æœ‰æºé€šéƒ½æœ‰è¨˜éŒ„å’Œè¿½è¹¤
   - **æ“´å±•å½ˆæ€§**ï¼šå±•ç¤ºå¦‚ä½•è¼•æ˜“æ·»åŠ æ–°éƒ¨é–€
   - **æ•ˆç‡æå‡**ï¼šå¼·èª¿æ¸›å°‘ç„¡æ•ˆæºé€šå’Œè¡çª

3. **æŠ€è¡“å¯¦ä½œè¦é»**ï¼š

   - **ä»‹é¢è¨­è¨ˆ**ï¼šä¸­ä»‹è€…ä»‹é¢è¦è¶³å¤ é€šç”¨
   - **äº‹ä»¶æ©Ÿåˆ¶**ï¼šè¨­è¨ˆæ¸…æ™°çš„äº‹ä»¶é€šçŸ¥æ©Ÿåˆ¶
   - **ç‹€æ…‹ç®¡ç†**ï¼šä¸­ä»‹è€…éœ€è¦ç¶­è­·å”èª¿ç‹€æ…‹
   - **æ•ˆèƒ½è€ƒé‡**ï¼šé¿å…ä¸­ä»‹è€…æˆç‚ºæ•ˆèƒ½ç“¶é ¸

4. **æ¶æ§‹æ±ºç­–å»ºè­°**ï¼š
   - **è¤‡é›œåº¦è©•ä¼°**ï¼šç¢ºèªäº’å‹•çœŸçš„è¤‡é›œåˆ°éœ€è¦ä¸­ä»‹è€…
   - **å–®ä¸€è·è²¬**ï¼šé¿å…ä¸­ä»‹è€…æ‰¿æ“”éå¤šè²¬ä»»
   - **æ›¿ä»£æ–¹æ¡ˆ**ï¼šè€ƒæ…®äº‹ä»¶åŒ¯æµæ’ç­‰å…¶ä»–å”èª¿æ©Ÿåˆ¶
   - **æ¸¬è©¦ç­–ç•¥**ï¼šé‡é»æ¸¬è©¦ä¸­ä»‹è€…çš„å”èª¿é‚è¼¯

## æ˜æ—¥é å‘Š ğŸ”®

æ˜å¤©æˆ‘å€‘å°‡æ¢è¨ **Memento Pattern - æ™‚å…‰å€‰åº«ç®¡ç†å“¡**ï¼Œå­¸ç¿’å¦‚ä½•æ‡‰å°è€é—†çš„å›¤ç©ç—‡å€™ç¾¤ï¼šã€ŒæŠŠæ¯å€‹ç‰ˆæœ¬éƒ½ä¿å­˜èµ·ä¾†ï¼Œèªªä¸å®šå“ªå¤©æˆ‘åˆæƒ³è¦èˆŠç‰ˆæœ¬ï¼ã€

æº–å‚™è¿æ¥æ™‚å…‰æ—…è¡Œçš„æŒ‘æˆ°ï¼ â°
